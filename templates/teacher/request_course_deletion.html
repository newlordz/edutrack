{% extends "base.html" %}

{% block title %}Request Course Deletion - Teacher Dashboard{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="mb-0">
                    <i class="fas fa-exclamation-triangle me-2"></i>Request Course Deletion
                </h1>
                <a href="{{ url_for('manage_course', course_id=course.id) }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Course
                </a>
            </div>
        </div>
    </div>

    <!-- Warning Alert -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="alert alert-warning" role="alert">
                <h5 class="alert-heading">
                    <i class="fas fa-exclamation-triangle me-2"></i>Important Notice
                </h5>
                <p class="mb-0">
                    <strong>Course: {{ course.title }}</strong><br>
                    You are requesting deletion of this course. This action requires admin approval and cannot be undone once approved.
                </p>
            </div>
        </div>
    </div>

    <!-- Course Information -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>Course Details
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Title:</strong> {{ course.title }}</p>
                            <p><strong>Description:</strong> {{ course.description[:100] }}{% if course.description|length > 100 %}...{% endif %}</p>
                            <p><strong>Difficulty:</strong> {{ course.difficulty }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Duration:</strong> {{ course.duration_weeks }} weeks</p>
                            <p><strong>Enrolled Students:</strong> {{ course.enrollments|length }}/{{ course.max_students }}</p>
                            <p><strong>Created:</strong> {{ course.created_at.strftime('%B %d, %Y') }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SIMPLE TEST FORM -->
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-edit me-2"></i>TEST FORM - Simple Version
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST" id="deletionForm">
                        <div class="mb-3">
                            <label for="reason" class="form-label">Reason for Deletion *</label>
                            <textarea class="form-control" id="reason" name="reason" rows="5" 
                                      placeholder="Please provide a detailed reason for why you want to delete this course..." required></textarea>
                            <div class="form-text">
                                Be specific about why this course should be deleted. This will help admins make an informed decision.
                            </div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('manage_course', course_id=course.id) }}" class="btn btn-secondary">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-warning">
                                <i class="fas fa-paper-plane me-2"></i>Submit Deletion Request
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Debug Info -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-bug me-2"></i>Debug Information
                    </h5>
                </div>
                <div class="card-body">
                    <p><strong>Form ID:</strong> deletionForm</p>
                    <p><strong>Form Method:</strong> POST</p>
                    <p><strong>Form Action:</strong> Current URL</p>
                    <p><strong>Button Type:</strong> submit</p>
                    <p><strong>Course ID:</strong> {{ course.id }}</p>
                    <p><strong>Course Title:</strong> {{ course.title }}</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
console.log('=== DEBUGGING FORM SUBMISSION ===');

document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded');
    
    const form = document.getElementById('deletionForm');
    const reason = document.getElementById('reason');
    const submitBtn = document.querySelector('button[type="submit"]');
    
    console.log('Form elements found:', {
        form: form,
        reason: reason,
        submitBtn: submitBtn
    });
    
    if (form) {
        form.addEventListener('submit', function(e) {
            console.log('Form submit event triggered!');
            
            const reasonValue = reason.value.trim();
            console.log('Reason value:', reasonValue);
            console.log('Reason length:', reasonValue.length);
            
            if (reasonValue.length < 20) {
                e.preventDefault();
                alert('Please provide a detailed reason (at least 20 characters) for the deletion request.');
                console.log('Form submission prevented - reason too short');
                return false;
            }
            
            console.log('Form validation passed, allowing submission...');
            return true;
        });
        
        console.log('Form submit event listener added');
    } else {
        console.error('Form not found!');
    }
    
    if (submitBtn) {
        submitBtn.addEventListener('click', function(e) {
            console.log('Submit button clicked!');
        });
        console.log('Submit button click event listener added');
    } else {
        console.error('Submit button not found!');
    }
});

console.log('Script loaded');
</script>
{% endblock %}
