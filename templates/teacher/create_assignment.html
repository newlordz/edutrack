{% extends "base.html" %}

{% block title %}Create Assignment - {{ course.title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('teacher_dashboard') }}">Teacher Dashboard</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('manage_course', course_id=course.id) }}">{{ course.title }}</a></li>
            <li class="breadcrumb-item active">Create Assignment</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h2>Create New Assignment</h2>
                    <h5 class="text-muted">Course: {{ course.title }}</h5>
                </div>
                <div class="card-body">
                    <form method="POST">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="form-group mb-3">
                                    <label for="title" class="form-label">Assignment Title *</label>
                                    <input type="text" class="form-control" id="title" name="title" required
                                           placeholder="e.g., Midterm Exam, Project 1, Quiz 2">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    <label for="assignment_type" class="form-label">Assignment Type *</label>
                                    <select class="form-control" id="assignment_type" name="assignment_type" required>
                                        <option value="assignment">Assignment</option>
                                        <option value="quiz">Quiz</option>
                                        <option value="exam">Exam</option>
                                        <option value="project">Project</option>
                                        <option value="presentation">Presentation</option>
                                        <option value="discussion">Discussion</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-group mb-3">
                            <label for="description" class="form-label">Description *</label>
                            <textarea class="form-control" id="description" name="description" rows="3" required
                                      placeholder="Brief description of what students need to do..."></textarea>
                        </div>

                        <div class="form-group mb-3">
                            <label for="instructions" class="form-label">Detailed Instructions</label>
                            <textarea class="form-control" id="instructions" name="instructions" rows="6"
                                      placeholder="Provide detailed step-by-step instructions for students..."></textarea>
                            <div class="form-text">This will be visible to students when they view the assignment.</div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="due_date" class="form-label">Due Date & Time *</label>
                                    <input type="datetime-local" class="form-control" id="due_date" name="due_date" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="max_score" class="form-label">Maximum Score *</label>
                                    <input type="number" class="form-control" id="max_score" name="max_score" 
                                           min="1" max="1000" value="100" required>
                                    <div class="form-text">Total points possible for this assignment.</div>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <strong>Assignment Settings:</strong>
                            <ul class="mb-0 mt-2">
                                <li>Students can submit text, files, or both</li>
                                <li>Late submissions will be marked but still accepted</li>
                                <li>Students can only submit once per assignment</li>
                                <li>You can grade submissions and provide feedback</li>
                            </ul>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('manage_course', course_id=course.id) }}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Back to Course
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Create Assignment
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5>Course Information</h5>
                </div>
                <div class="card-body">
                    <p><strong>Course:</strong> {{ course.title }}</p>
                    <p><strong>Difficulty:</strong> {{ course.difficulty }}</p>
                    <p><strong>Duration:</strong> {{ course.duration_weeks }} weeks</p>
                    <p><strong>Enrolled Students:</strong> {{ course.get_enrolled_count() }}/{{ course.max_students }}</p>
                    
                    <div class="mt-3">
                        <h6>Current Assignments:</h6>
                        {% set current_assignments = course.assignments|selectattr('is_active', 'equalto', true)|list %}
                        {% if current_assignments %}
                            <ul class="list-unstyled">
                                {% for assignment in current_assignments %}
                                <li class="mb-2">
                                    <small>
                                        <i class="fas fa-tasks"></i> {{ assignment.title }}
                                        <br><span class="text-muted">Due: {{ assignment.due_date.strftime('%m/%d') }}</span>
                                    </small>
                                </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="text-muted small">No assignments created yet.</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header">
                    <h5>Assignment Tips</h5>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled small">
                        <li class="mb-2"><i class="fas fa-lightbulb text-warning"></i> Be specific with instructions</li>
                        <li class="mb-2"><i class="fas fa-lightbulb text-warning"></i> Set realistic due dates</li>
                        <li class="mb-2"><i class="fas fa-lightbulb text-warning"></i> Use clear grading criteria</li>
                        <li class="mb-2"><i class="fas fa-lightbulb text-warning"></i> Consider assignment weight in course</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Set minimum date to today
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date();
    const tomorrow = new Date(today);
    tomorrow.setDate(tomorrow.getDate() + 1);
    
    const dueDateInput = document.getElementById('due_date');
    const minDate = tomorrow.toISOString().slice(0, 16);
    dueDateInput.min = minDate;
    
    // Set default due date to tomorrow at 11:59 PM
    const defaultDate = new Date(tomorrow);
    defaultDate.setHours(23, 59);
    dueDateInput.value = defaultDate.toISOString().slice(0, 16);
});
</script>
{% endblock %}
