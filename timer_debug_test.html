<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timer Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .timer { font-size: 3em; font-weight: bold; color: #333; text-align: center; margin: 20px 0; font-family: 'Courier New', monospace; }
        .controls { margin: 20px 0; text-align: center; }
        button { padding: 12px 24px; margin: 8px; font-size: 16px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        .debug { background: #f8f9fa; padding: 15px; margin: 20px 0; border-radius: 5px; font-family: monospace; font-size: 14px; max-height: 300px; overflow-y: auto; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>⏰ Timer Debug Test</h1>
        <p>This page tests the timer functionality in isolation to identify any issues.</p>
        
        <div class="timer" id="timer">00:00</div>
        
        <div class="controls">
            <button class="btn-primary" onclick="startClassTimer()">Start Class Timer</button>
            <button class="btn-success" onclick="startManualTimer()">Start Manual Timer</button>
            <button class="btn-warning" onclick="pauseTimer()">Pause</button>
            <button class="btn-info" onclick="resetTimer()">Reset</button>
            <button class="btn-danger" onclick="clearLogs()">Clear Logs</button>
        </div>
        
        <div class="status info">
            <strong>Instructions:</strong> Click "Start Class Timer" to test the QuizTimer class, or "Start Manual Timer" to test basic setInterval functionality.
        </div>
        
        <div class="debug" id="debug"></div>
    </div>

    <script>
        let classTimer = null;
        let manualTimer = null;
        let isPaused = false;
        
        // QuizTimer class (copied from take_quiz.html)
        class QuizTimer {
            constructor(minutes) {
                this.totalSeconds = minutes * 60;
                this.remainingSeconds = this.totalSeconds;
                this.isRunning = false;
                this.timerInterval = null;
                this.init();
            }
            
            init() {
                log('QuizTimer.init() called');
                this.updateDisplay();
                this.start();
                this.setupWarningLevels();
            }
            
            start() {
                log('QuizTimer.start() called');
                log('Starting timer with ' + this.remainingSeconds + ' seconds remaining');
                this.isRunning = true;
                
                // Clear any existing interval first
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    log('Cleared existing interval: ' + this.timerInterval);
                }
                
                this.timerInterval = setInterval(() => {
                    log('Timer tick triggered!');
                    this.remainingSeconds--;
                    log('Timer tick: ' + this.remainingSeconds + ' seconds remaining');
                    this.updateDisplay();
                    
                    if (this.remainingSeconds <= 0) {
                        this.expire();
                    }
                }, 1000);
                
                log('Timer interval set, ID: ' + this.timerInterval);
                log('Timer should now be running...');
                
                // Test if interval is actually working
                setTimeout(() => {
                    log('After 1 second, remaining seconds: ' + this.remainingSeconds);
                    if (this.remainingSeconds === this.totalSeconds - 1) {
                        log('✅ Timer is working correctly!');
                    } else {
                        log('❌ Timer is NOT working!');
                    }
                }, 1100);
            }
            
            updateDisplay() {
                const minutes = Math.floor(this.remainingSeconds / 60);
                const seconds = this.remainingSeconds % 60;
                const timeString = minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');
                
                log('Updating display: ' + timeString + ' (' + this.remainingSeconds + ' seconds)');
                
                const timerElement = document.getElementById('timer');
                if (timerElement) {
                    timerElement.textContent = timeString;
                    log('Main timer updated to: ' + timeString);
                } else {
                    log('❌ Timer element not found!');
                }
            }
            
            setupWarningLevels() {
                this.warningLevels = [
                    { threshold: this.totalSeconds * 0.25, class: 'text-warning' },
                    { threshold: this.totalSeconds * 0.1, class: 'text-danger' },
                    { threshold: 60, class: 'text-danger pulse' }
                ];
            }
            
            expire() {
                log('Timer expired!');
                this.stop();
                const timerElement = document.getElementById('timer');
                if (timerElement) {
                    timerElement.textContent = 'TIME EXPIRED!';
                }
            }
            
            stop() {
                log('Timer stopped');
                this.isRunning = false;
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
            }
            
            pause() {
                log('Timer paused');
                this.stop();
            }
            
            resume() {
                log('Timer resumed');
                this.start();
            }
        }
        
        // Manual timer functions
        function startClassTimer() {
            log('=== STARTING CLASS TIMER ===');
            try {
                if (classTimer) {
                    classTimer.stop();
                }
                classTimer = new QuizTimer(2); // 2 minutes
                log('✅ QuizTimer created successfully');
            } catch (error) {
                log('❌ Error creating QuizTimer: ' + error);
                console.error(error);
            }
        }
        
        function startManualTimer() {
            log('=== STARTING MANUAL TIMER ===');
            try {
                if (manualTimer) {
                    clearInterval(manualTimer);
                }
                
                let seconds = 10;
                log('Starting 10-second manual countdown...');
                
                manualTimer = setInterval(() => {
                    seconds--;
                    log('Manual tick: ' + seconds + ' seconds remaining');
                    
                    if (seconds <= 0) {
                        clearInterval(manualTimer);
                        document.getElementById('timer').textContent = 'MANUAL COMPLETE!';
                        log('Manual timer completed!');
                        return;
                    }
                    
                    const timeString = '00:' + seconds.toString().padStart(2, '0');
                    document.getElementById('timer').textContent = timeString;
                    log('Updated display to: ' + timeString);
                }, 1000);
                
                log('✅ Manual timer started with interval ID: ' + manualTimer);
            } catch (error) {
                log('❌ Error starting manual timer: ' + error);
                console.error(error);
            }
        }
        
        function pauseTimer() {
            log('=== PAUSING TIMERS ===');
            if (classTimer && classTimer.isRunning) {
                classTimer.pause();
                log('Class timer paused');
            }
            if (manualTimer) {
                clearInterval(manualTimer);
                log('Manual timer paused');
            }
        }
        
        function resetTimer() {
            log('=== RESETTING TIMERS ===');
            if (classTimer) {
                classTimer.stop();
                classTimer = null;
            }
            if (manualTimer) {
                clearInterval(manualTimer);
                manualTimer = null;
            }
            document.getElementById('timer').textContent = '00:00';
            log('Timers reset');
        }
        
        function clearLogs() {
            document.getElementById('debug').innerHTML = '';
            log('Logs cleared');
        }
        
        function log(message) {
            const debug = document.getElementById('debug');
            const timestamp = new Date().toLocaleTimeString();
            debug.innerHTML += '[' + timestamp + '] ' + message + '<br>';
            debug.scrollTop = debug.scrollHeight;
            console.log(message);
        }
        
        // Initialize
        log('Timer debug test page loaded');
        log('Testing basic JavaScript functionality...');
        
        // Test basic functionality
        setTimeout(() => {
            log('Basic timeout test passed');
        }, 100);
        
        // Test setInterval
        let testInterval = setInterval(() => {
            log('Basic setInterval test passed');
            clearInterval(testInterval);
        }, 200);
    </script>
</body>
</html>
